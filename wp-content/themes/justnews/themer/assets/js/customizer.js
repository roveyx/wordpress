!function n(a,r,l){function d(t,e){if(!r[t]){if(!a[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(c)return c(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var i=r[t]={exports:{}};a[t][0].call(i.exports,function(e){return d(a[t][1][e]||e)},i,i.exports,n,a,r,l)}return r[t].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)d(l[e]);return d}({1:[function(e,t,s){"use strict";function o(){var t=this;this.VE=parent.VE,this.$el=$(".wpcom-container"),this.VE.onMessage(window,function(e){if(e.data&&e.data.type)switch(e.data.type){case"modules":t.initModuleWrap(),e.data.preID&&jQuery("#modules-"+e.data.preID).length&&jQuery("html,body").animate({scrollTop:jQuery("#modules-"+e.data.preID).offset().top-50},100);break;case"preview":t.preview();break;case"insert-module":t.inertModule(e.data.modules,e.data.target);break;case"remove-module":t.removeModule(e.data.module)}}),this.init()}var i;o.prototype={init:function(){var t=this,e=this.pageType(),s=2===e.type||4===e.type;this.pid=s?e.id:0,this.VE.postMessage({type:"iframe-loaded",pid:this.pid},parent),this.$el.find(".modules-my-module").each(function(){var e=jQuery(this);e.find(".wpcom-modules").removeClass("wpcom-modules"),e.find(".j-modules-inner").removeClass("j-modules-inner")});var o=this.VE.getData(this.pid);this.pid&&!o?$.ajax({type:"POST",url:_wpcom_js.ajaxurl,data:{action:"wpcom_page_modules",id:this.pid},dataType:"json"}).then(function(e){Array.isArray(e)&&(t.VE.setData(t.pid,e),s&&t.$el.length&&t.initEventListener())},function(){t.VE.setData(t.pid,[]),s&&t.$el.length&&t.initEventListener()}):o&&s&&this.$el.length&&this.initEventListener()},initEventListener:function(){var a=this;this.sortables={},this.$clone=null,$(document).on("mouseenter",".wpcom-modules",function(e){$(".wpcom-moving").length||($(this).siblings().removeClass("wpcom-focus"),$(this).addClass("wpcom-focus"),0==$(this).find("> .wpcom-modules-tool").length&&$(this).append('<div class="wpcom-modules-tool material-icons"><div class="wpcom-tool-move">open_with</div><div class="wpcom-tool-edit">edit</div><div class="wpcom-tool-copy">layers</div><div class="wpcom-tool-save">cloud_upload</div><div class="wpcom-tool-delete">delete_forever</div></div>'))}).on("mouseleave",".wpcom-modules",function(){$(".wpcom-moving").length||$(this).removeClass("wpcom-focus")}).on("mouseenter",".wpcom-modules-tool",function(){$(this).closest(".wpcom-modules").addClass("wpcom-edit")}).on("mouseleave",".wpcom-modules-tool",function(){$(this).closest(".wpcom-modules").removeClass("wpcom-edit")}).on("click.wpcom.edit",".wpcom-tool-edit",function(){var e=$(this).closest(".wpcom-modules").attr("id"),t=a.allModules(1);e=a.getID(e),a.VE.postMessage({type:"wpcom-panel",module:t[e]},parent)}).on("click.wpcom.copy",".wpcom-tool-copy",function(){var e=$(this).closest(".wpcom-modules"),t=a.allModules(1),s=Object.assign({},t[a.getID(e.attr("id"))]),o=e.parent().closest(".wpcom-modules"),i="wpcom-container";o.length&&(i=o.attr("id"),o.hasClass("modules-gird")&&(i=i+"["+e.closest(".j-modules-inner").index()+"]"));var n=e.clone().insertAfter(e);a.save(i,a.resetID(s,n)),a.VE.postMessage({type:"close-wpcom-panel"},parent)}).on("click.wpcom.del",".wpcom-tool-delete",function(){var e=$(this).closest(".wpcom-modules"),t=e.parent().closest(".wpcom-modules"),s="wpcom-container";t.length&&(s=t.attr("id"),t.hasClass("modules-gird")&&(s=s+"["+e.closest(".j-modules-inner").index()+"]")),e.remove(),a.save(s),a.VE.postMessage({type:"close-wpcom-panel"},parent)}).on("click.wpcom.save",".wpcom-tool-save",function(){var e=$(this).closest(".wpcom-modules").attr("id"),t=a.allModules(1);e=a.getID(e),a.VE.postMessage({type:"save-module",module:t[e]},parent)});var e,t=[];t.push(document.querySelector(".wpcom-container")),t=t.concat([].slice.call(document.querySelectorAll(".j-modules-inner")));for(var s=0;s<t.length;s++){var o=$(t[s]).closest(".wpcom-modules"),i=o.length?o.attr("id"):"wpcom-container";o.hasClass("modules-gird")&&(i=i+"["+$(t[s]).index()+"]"),this.sortables[i]=(e=i,new Sortable(t[s],a.sortConfig(e)))}setTimeout(function(){a.VE.postMessage({type:"wpcom-tool-loaded"},parent)},300)},initModuleWrap:function(){var t=this;new Sortable(parent.document.querySelector("#ve-modules .mod-wrap"),{group:{name:"modules",pull:"clone",put:!1},animation:150,sort:!1,onStart:function(e){t.VE.postMessage({type:"close-wpcom-panel"},parent),$("body").addClass("wpcom-moving"),parent.document.body.classList.add("wpcom-moving"),t.checkDisable(e.item,1)},onEnd:function(e){$("body").removeClass("wpcom-moving"),parent.document.body.classList.remove("wpcom-moving"),t.checkDisable(e.item,0)}})},preview:function(){this.VE.postMessage({type:"iframe-reload"},parent);var e=document.createElement("form");e.method="POST",e.id="wpcom-iframe-form";var t=document.createElement("input");t.type="hidden",t.name="module-datas",t.value=window.btoa(unescape(encodeURIComponent(JSON.stringify(this.VE.getData(this.pid))))),e.appendChild(t);var s=document.createElement("input");s.type="hidden",s.name="css",s.value=window.btoa(unescape(encodeURIComponent(parent._panel_options.settings.css))),e.appendChild(s);var o=document.createElement("input");o.type="submit",o.value="submit",e.appendChild(o),document.body.appendChild(e),e.submit(),e.remove()},inertModule:function(e,t){var s=jQuery("#modules-"+t),o=s.closest(".j-modules-inner"),i="wpcom-container";if(o.length){var n=o.closest(".wpcom-modules");i=n.attr("id"),n.hasClass("modules-gird")&&(i=i+"["+o.index()+"]")}for(var a in e)e[a].id!=t&&jQuery('<section class="section wpcom-modules wpcom-modules-new" id="modules-'+e[a].id+'" style="height:32px;"></section>').insertAfter(s),this.save(i,e[a]);this.preview()},removeModule:function(e){if(e){var t=jQuery("#modules-"+e),s=t.parent().closest(".wpcom-modules"),o="wpcom-container";s.length&&(o=s.attr("id"),s.hasClass("modules-gird")&&(o=o+"["+t.closest(".j-modules-inner").index()+"]")),t.remove(),this.save(o)}},getChilds:function(e,t){if(e&&t){var s=e,o=e.match(/modules-([\d-_]+)\[(\d+)\]$/);for(var i in o&&o[1]&&(e="modules-"+o[1]),t)if(e==="modules-"+t[i].id){if(t[i].settings.girds&&o&&o[2])return t[i].settings.girds[o[2]];if(t[i].settings.modules)return t[i].settings.modules}else{var n=null;t[i].settings.girds&&o&&o[2]?n=t[i].settings.girds[o[2]]:t[i].settings.modules&&(n=t[i].settings.modules);var a=this.getChilds(s,n);if(a)return a}}},pageType:function(){for(var e,t,s=document.querySelector("body").classList,o=0,i=0;i<s.length;i++)switch(s[i]){case"page":e=2;break;case"category":e=3;break;case"single":case"single-page_module":e=4;break;case"home":e=1}if(2===e)for(i=0;i<s.length;i++)(t=s[i].match(/page-id-(\d+)$/))&&(o=t[1]);else if(4===e)for(i=0;i<s.length;i++)(t=s[i].match(/postid-(\d+)$/))&&(o=t[1]);return{type:e,id:o}},getID:function(e){var t=e.match(/modules-([\d-_]+)$/);if(t&&t[1])return t[1]},newID:function(){var e=this.allModules(),t=1;if(e)for(var s in e)(t<=s||$("#modules-"+t).length)&&(t=+s+1);return this.lastID&&t<=this.lastID&&(t=this.lastID+1),this.lastID=t},save:function(e,t){if(!e)return!1;var s=this.sortables[e],o=[];if(s&&s.options){if("wpcom-container"===e)o=s.options.store.set(s,t);else{var i=Object.assign([],this.VE.getData(this.pid));o=this.saveChildModules(e,i,s,t)}for(var n in this.VE.setData(this.pid,o),this.sortables)if("wpcom-container"!==n){var a=n,r=n.match(/modules-([\d-_]+)\[(\d+)\]$/);r&&r[1]&&(n="modules-"+r[1]),0===$("#"+n).length&&(this.sortables[a].destroy(),delete this.sortables[a])}}return o},saveChildModules:function(e,t,s,o){if(e&&t){var i=e.match(/modules-([\d-_]+)\[(\d+)\]$/),n=i&&i[1]?i[1]:this.getID(e);for(var a in t){var r=null,l="";if(t[a].settings&&t[a].settings.girds?(r=t[a].settings.girds,l="girds"):t[a].settings&&t[a].settings.modules&&(r=t[a].settings.modules,l="modules"),l&&t[a].id==n)i&&i[1]&&"girds"===l?t[a].settings[l][i[2]]=s.options.store.set(s,o):t[a].settings[l]=s.options.store.set(s,o);else if(l&&r)if(i&&i[1]&&"girds"===l)for(var d in r)t[a].settings[l][d]=this.saveChildModules(e,t[a].settings[l][d],s,o);else t[a].settings[l]=this.saveChildModules(e,t[a].settings[l],s,o)}return t}},allModules:function(e){var t=Object.assign([],this.VE.getData(this.pid));return this.loopModules(t,e)},loopModules:function(e,t){var s={};if(e)for(var o=0;o<e.length;o++){var i=$.extend(!0,{},e[o]);if(i&&i.settings){var n=null,a="";if(i.settings.girds?(n=i.settings.girds,a="girds"):i.settings.modules&&(n=i.settings.modules,a="modules"),"girds"===a&&n){for(var r in n)s=Object.assign(s,this.loopModules(n[r],t));!t&&i.settings[a]&&(i.settings[a]=[])}else n&&(s=Object.assign(s,this.loopModules(n,t)),!t&&i.settings[a]&&(i.settings[a]=[]))}s[i.id]=i}return s},resetID:function(e,t){if(e&&e.id){var s=this;e.id=this.newID();var o="modules-"+e.id;if(t.attr("id",o),e.settings.modules){for(var i in e.settings.modules)e.settings.modules[i]=this.resetID(e.settings.modules[i],t.find("#modules-"+e.settings.modules[i].id));this.sortables[o]=(d=o,new Sortable(t.find("> .j-modules-inner")[0],s.sortConfig(d)))}else if(e.settings.girds)for(var n in e.settings.girds)if(e.settings.girds[n]){for(var a in e.settings.girds[n])e.settings.girds[n][a]=this.resetID(e.settings.girds[n][a],t.find("#modules-"+e.settings.girds[n][a].id));var r=o+"["+n+"]";this.sortables[r]=(l=r,new Sortable(t.find("> .j-modules-inner")[0],s.sortConfig(l)))}}var l,d;return e},sortConfig:function(n){var l=this;return{group:"modules",draggable:".wpcom-modules",handle:".wpcom-tool-move",dragoverBubble:!0,sort:!0,dataIdAttr:"id",swapThreshold:.9,emptyInsertThreshold:60,invertSwap:!0,store:{get:function(e){var t=Object.assign([],l.VE.getData(l.pid));return"wpcom-container"===n?t:l.getChilds(n,t)},set:function(e,t){var s=e.toArray(),o=l.allModules(1);t&&t.id&&t.type&&(o[t.id]=t);var i=[];for(var n in s){var a=l.getID(s[n]);if(a)for(var r in o)if(o[r].id==a){i.push(o[r]);break}}return i}},onStart:function(e){l.VE.postMessage({type:"close-wpcom-panel"},parent),$("body").addClass("wpcom-moving");var t=$(e.item);t.parents(".modules-gird").length&&t.parents(".modules-gird").removeClass("wpcom-focus"),t.parents(".j-modules-wrap").length&&t.parents(".j-modules-wrap").removeClass("wpcom-focus"),l.checkDisable(e.item,1)},onEnd:function(e){$("body").removeClass("wpcom-moving").removeClass("wpcom-moving-changed"),l.$clone&&l.$clone.remove(),l.checkDisable(e.item,0)},onUpdate:function(){l.save(n)},onAdd:function(e){var t=$(e.item);if(t.hasClass("mod-item")){var s=l.newID(),o={type:t.data("type"),settings:{},id:s};"fullwidth"===o.type||"sidebar-layout"===o.type?o.settings.modules=[]:"gird"===o.type&&(o.settings.girds=[]);var i=t.parent().closest(".wpcom-modules").length?1:0;i=t.parent().closest(".modules-gird").length?2:i,t.replaceWith('<section class="section wpcom-modules wpcom-modules-new" id="modules-'+s+'" style="height:32px;"></section>'),l.save(n,o),l.VE.postMessage({type:"wpcom-panel",module:o,parent:i},parent),this.options.onEnd(e),setTimeout(function(){l.VE.postMessage({type:"close-module-list"},parent)},300)}else l.save(n),setTimeout(function(){l.preview()},500)},onRemove:function(e){l.save(n)},onChange:function(e){$("body").addClass("wpcom-moving-changed"),$(".wpcom-inner").length&&$(".wpcom-inner").hide()},setData:function(e){var t=document.createElement("div");t.classList.add("sortable-drag-clone"),t.innerHTML='<span class="sortable-drag-icon">open_with</span>',l.$clone=document.body.appendChild(t),e.setDragImage(l.$clone,20,20)}}},checkDisable:function(e,t){if(t){var s=e.id?this.getID(e.id):0,o=this.allModules(),i="";if(jQuery(e).hasClass("mod-item")&&(i=jQuery(e).data("type")),s&&o[s]||i){if("my-module"===(i=i||o[s].type)){var n=jQuery(e);n.find(".modules-sidebar-layout").length?i="sidebar-layout":n.find(".modules-fullwidth").length?i="fullwidth":n.find(".modules-gird").length&&(i="gird")}var a=[];if("fullwidth"===i?a=["fullwidth","sidebar-layout","gird"]:"sidebar-layout"===i?a=["sidebar-layout","gird"]:"gird"===i&&(a=["gird"]),a.length)for(var r in this.sortables)if("wpcom-container"!==r){var l=r.match(/modules-([\d-_]+)\[(\d+)\]$/),d=l&&l[1]?l[1]:this.getID(r);d&&o[d]&&o[d].type&&-1<a.indexOf(o[d].type)&&this.sortables[r].option("disabled",!0)}}}else for(var r in this.sortables)this.sortables[r].option("disabled",!1)}},i=jQuery,window.onload=function(){new o},i(document).on("click","a",function(){var e=i(this);e.attr("href").match(/^(#|javascript:)/i)||e.attr("target","_blank")})},{}]},{},[1]);