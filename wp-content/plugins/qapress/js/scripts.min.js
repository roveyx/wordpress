function notice(e,s,a,t){var n=t||jQuery(".mce-tinymce");clearTimeout(timer),jQuery("#notice").remove(),n.append('<div id="notice"><div class="notice-bg"></div><div class="notice-wrap"><div class="notice-inner notice-'+e+'">'+s+"</div></div></div>"),a&&(timer=setTimeout(function(){jQuery("#notice").remove()},a))}function comments_list(e,s){var a="";if(e&&e.length)for(var t=0;t<e.length;t++)a+='<li class="as-comments-item" data-id="'+e[t].ID+'">            <div class="as-comment-name">'+e[t].user+" <span>"+e[t].date+"</span>"+("1"==s?'<span><a class="j-del-comment" href="javascript:;">删除</a></span>':"")+'</div>            <div class="as-comment-content">'+e[t].content+"</div>            </li>";else a+='<li class="as-comments-none">暂无评论</li>';return a}var timer=null;jQuery(document).ready(function(e){var s=0,a=e(".q-single");a.length&&e.ajax({url:QAPress_js.ajaxurl,data:{action:"QAPress_views",id:a.data("id")},type:"POST",success:function(e){}}),e("#answer").on("click",".j-reply",function(){var s=e(this).closest(".as-item");if(s.find(".as-comments-box").length)e(".as-comments-box").remove(),e(".as-comments").remove();else{var a='<div class="as-comments-box">        <form method="post" class="as-comments-form clearfix">        <input type="hidden" name="id" value="'+s.data("aid")+'" >    <input class="as-comments-input form-control" name="comment" type="text" placeholder="我来评论" autocomplete="off">    <input class="as-comments-submit" type="submit" value="提 交">    </form></div>';e(".as-comments-box").remove(),e(".as-comments").remove(),s.find(".as-main").append(a),s.find(".as-comments-input").focus()}}),e("#answer").on("click",".j-reply-list",function(){var s=e(this).closest(".as-item");s.find(".as-comments").length?(e(".as-comments-box").remove(),e(".as-comments").remove()):(e(".as-comments-box").remove(),e(".as-comments").remove(),s.find(".as-main").append('<div class="as-comments"><ul class="as-comments-list"><li class="as-comments-none"><img class="notice-loading" src="'+QAPress_js.ajaxloading+'"> 正在加载...</li></ul></div>'),e.ajax({url:QAPress_js.ajaxurl,data:{action:"QAPress_comments",aid:s.data("aid")},type:"POST",dataType:"json",success:function(e){if(0==e.result){var a=comments_list(e.comments,e.delete);s.find(".as-main .as-comments-list").html(a)}else s.find(".as-main .as-comments-list").html('<li class="as-comments-none">参数错误，请重试</li>'),notice(0,"参数错误，请重试",1200,s)},error:function(){s.find(".as-main .as-comments-list").html('<li class="as-comments-none">请求失败，请重试</li>'),notice(0,"请求失败，请重试",1200,s)}}))}).on("click",".j-answer-del",function(){if(confirm("删除操作无法恢复，并将同时删除当前回复的评论信息，您确定要删除吗？")){$el=e(this).closest(".as-item"),notice(1,'<img class="notice-loading" src="'+QAPress_js.ajaxloading+'"> 正在删除...',0,$el);var s=$el.data("aid");e.ajax({url:QAPress_js.ajaxurl,data:{action:"QAPress_delete_answer",id:s},type:"POST",dataType:"json",success:function(s){clearTimeout(timer),e("#notice").remove(),0==s.result?(notice(1,"操作成功！",1500,$el),setTimeout(function(){$el.fadeOut("fast",function(){var e=$el.closest(".as-list");$el.remove(),0==e.find(".as-item").length&&e.append('<li class="as-item-none" style="text-align: center;color: #999;padding-top: 10px;">暂无回复</li>')})},1400)):2==s.result?notice(0,"无操作权限！",1200,$el):notice(0,"操作异常，请重试！",1200,$el)},error:function(s){clearTimeout(timer),e("#notice").remove(),notice(0,"操作异常，请稍后再试！",1200,$el)}})}}).on("click",".j-del-comment",function(){if(confirm("删除操作无法恢复，您确定要删除吗？")){$el=e(this).closest(".as-comments-item"),notice(1,'<img class="notice-loading" src="'+QAPress_js.ajaxloading+'"> 正在删除...',0,$el);var s=$el.data("id");e.ajax({url:QAPress_js.ajaxurl,data:{action:"QAPress_delete_comment",id:s},type:"POST",dataType:"json",success:function(s){clearTimeout(timer),e("#notice").remove(),0==s.result?(notice(1,"操作成功！",1500,$el),setTimeout(function(){$el.fadeOut("fast",function(){var e=$el.closest(".as-comments-list");$el.remove(),0==e.find(".as-comments-item").length&&e.append('<li class="as-comments-none">暂无评论</li>')})},1400)):2==s.result?notice(0,"无操作权限！",1200,$el):notice(0,"操作异常，请重试！",1200,$el)},error:function(s){clearTimeout(timer),e("#notice").remove(),notice(0,"操作异常，请稍后再试！",1200,$el)}})}}),e("#as-form").submit(function(){if(s)return!1;s=1,tinyMCE.triggerSave();var a=e("#editor-answer").val();return e.trim(a)?(notice(1,'<img class="notice-loading" src="'+QAPress_js.ajaxloading+'"> 正在提交...',0),e.ajax({url:QAPress_js.ajaxurl,data:e(this).serialize()+"&action=QAPress_add_answer",type:"POST",dataType:"json",success:function(a){if(s=0,0==a.result){notice(1,"提交成功！",1200);var t='<li id="as-'+a.answer.ID+'" class="as-item" data-aid="'+a.answer.ID+'" style="display: none;">                            <div class="as-avatar">'+a.user.avatar+'</div>                        <div class="as-main">                        <div class="as-user">'+a.user.nickname+'</div>                        <div class="as-content entry-content">'+a.answer.content+'</div>                        <div class="as-action">                        <span class="as-time">'+a.answer.date+'</span>                        <span class="as-reply-count"><a class="j-reply-list" href="javascript:;">0条评论</a></span>                        <span class="as-reply"><a class="j-reply" href="javascript:;">我来评论</a></span>                        </div>                        </div>                        </li>';e(".as-list").append(t),e("#as-"+a.answer.ID).fadeIn(),e(".as-item-none").remove(),tinyMCE.activeEditor.setContent("")}else 101==a.result?notice(0,"内容不能为空",1200):2==a.result?notice(0,"抱歉，您需要登录才能进行回复",2e3):notice(0,"提交失败，请重试！",1200)},error:function(e){s=0,notice(0,"提交失败，请稍后再试！",1200)}}),!1):(notice(0,"内容不能为空",1e3),s=0,!1)}),e("#answer").on("submit",".as-comments-form",function(){if(s)return!1;s=1;var a=e(this).find(".as-comments-input").val(),t=e(this).closest(".as-item");return e.trim(a)?(notice(1,'<img class="notice-loading" src="'+QAPress_js.ajaxloading+'"> 正在提交...',0,t),e.ajax({url:QAPress_js.ajaxurl,data:e(this).serialize()+"&action=QAPress_add_comment",type:"POST",dataType:"json",success:function(e){s=0,0==e.result?(notice(1,"提交成功",2e3,t),t.find(".as-comments-input").val("")):101==e.result?notice(0,"内容不能为空",1200,t):2==e.result?notice(0,"抱歉，您需要登录才能进行回复",2e3,t):notice(0,"提交失败，请重试！",1200,t)},error:function(e){s=0,notice(0,"提交失败，请稍后再试！",1200,t)}}),!1):(notice(0,"内容不能为空",1200,t),s=0,!1)}),e("#question-form").submit(function(){if(s)return!1;s=1,tinyMCE.triggerSave();var a=e("input[name=title]").val(),t=e("select[name=category]").val(),n=e("#editor-question").val();return a?t?e.trim(n)?(notice(1,'<img class="notice-loading" src="'+QAPress_js.ajaxloading+'"> 正在提交...',0),e.ajax({url:QAPress_js.ajaxurl,data:e(this).serialize()+"&action=QAPress_add_question",type:"POST",dataType:"json",success:function(a){s=0,0==a.result?(console.log(a),e("input[name=id]").val()?notice(1,void 0===a.msg?"更新成功！":a.msg,1500):(s=1,notice(1,void 0===a.msg?"发布成功！":a.msg,1200)),void 0!==a.location&&setTimeout(function(){window.location.href=a.location,s=0},1200)):101==a.result?notice(0,"标题、分类和内容不能为空",1200):102==a.result?notice(0,"内容长度不能少于10个字符",1200):notice(0,"提交失败，请重试！",1200)},error:function(e){s=0,notice(0,"提交失败，请稍后再试！",1200)}}),!1):(notice(0,"请输入内容",1200),s=0,!1):(notice(0,"请选择分类",1200),s=0,!1):(notice(0,"请输入标题",1200),s=0,!1)}),e("#answer").on("click",".q-load-more",function(){var s=e(this);if(!s.hasClass("disabled")){s.addClass("disabled").text("正在加载中...");var a=e(".q-single").data("id"),t=s.data("page");t=t||2,e.ajax({url:QAPress_js.ajaxurl,data:{action:"QAPress_answers_pagination",question:a,page:t},type:"POST",dataType:"json",success:function(a){if(0==a.result){var n="";if(a.answers.length){for(var i=0;i<a.answers.length;i++)n+='<li id="as-'+a.answers[i].ID+'" class="as-item" data-aid="'+a.answers[i].ID+'">                    <div class="as-avatar">'+a.answers[i].avatar+'</div>                    <div class="as-main">                        <div class="as-user">'+a.answers[i].name+'</div>                        <div class="as-content entry-content">'+a.answers[i].content+'</div>                        <div class="as-action">                            <span class="as-time">'+a.answers[i].time+'</span>                            <span class="as-reply-count"><a class="j-reply-list" href="javascript:;">'+a.answers[i].comments+'条评论</a></span>                            <span class="as-reply"><a class="j-reply" href="javascript:;">我来评论</a></span>                        '+("1"==a.delete?'<span class="as-del"><a class="j-answer-del" href="javascript:;">删除</a></span>':"")+"</div>                    </div>                </li>";e(".as-list").append(n)}else e(".q-load-more").css("visibility","hidden"),notice(1,"回复已经全部加载",1200,e(".as-list"))}else notice(0,"加载失败，请重试！",1200,e(".as-list"));s.removeClass("disabled").text("加载更多评论"),s.data("page",t+1)},error:function(a){s.removeClass("disabled").text("加载更多评论"),notice(0,"加载失败，请稍后再试！",1200,e(".as-list"))}})}}),e(".topic-header").on("click",".j-del",function(){if(confirm("删除操作无法恢复，并将同时删除当前问题的回复评论信息，您确定要删除吗？")){notice(1,'<img class="notice-loading" src="'+QAPress_js.ajaxloading+'"> 正在删除...',0,e(".q-entry"));var s=e(".q-single").data("id");e.ajax({url:QAPress_js.ajaxurl,data:{action:"QAPress_delete_question",id:s},type:"POST",dataType:"json",success:function(s){clearTimeout(timer),e("#notice").remove(),0==s.result?notice(1,"操作成功！",1500,e(".q-entry")):2==s.result?notice(0,"无操作权限！",1200,e(".q-entry")):notice(0,"操作异常，请重试！",1200,e(".q-entry"))},error:function(s){clearTimeout(timer),e("#notice").remove(),notice(0,"操作异常，请稍后再试！",1200,e(".q-entry"))}})}}).on("click",".j-approve",function(){if(confirm("确定要将当前问题设置为审核通过吗？")){notice(1,'<img class="notice-loading" src="'+QAPress_js.ajaxloading+'"> 正在处理...',0,e(".q-entry"));var s=e(".q-single").data("id");e.ajax({url:QAPress_js.ajaxurl,data:{action:"QAPress_approve_question",id:s},type:"POST",dataType:"json",success:function(s){clearTimeout(timer),e("#notice").remove(),0==s.result?(notice(1,"操作成功！",1500,e(".q-entry")),e(".j-approve").remove()):2==s.result?notice(0,"无操作权限！",1200,e(".q-entry")):notice(0,"操作异常，请重试！",1200,e(".q-entry"))},error:function(s){clearTimeout(timer),e("#notice").remove(),notice(0,"操作异常，请稍后再试！",1200,e(".q-entry"))}})}}).on("click",".j-set-top",function(){notice(1,'<img class="notice-loading" src="'+QAPress_js.ajaxloading+'"> 正在处理...',0,e(".q-entry"));var s=e(".q-single").data("id");e.ajax({url:QAPress_js.ajaxurl,data:{action:"QAPress_set_top",id:s},type:"POST",dataType:"json",success:function(s){clearTimeout(timer),e("#notice").remove(),0==s.result?(notice(1,"操作成功！",1500,e(".q-entry")),window.location.reload()):2==s.result?notice(0,"无操作权限！",1200,e(".q-entry")):notice(0,"操作异常，请重试！",1200,e(".q-entry"))},error:function(s){clearTimeout(timer),e("#notice").remove(),notice(0,"操作异常，请稍后再试！",1200,e(".q-entry"))}})}),e(".profile-QAPress-tab").on("click",".QAPress-tab-item",function(){var s=e(this).index();e(".QAPress-tab-item").removeClass("active"),e(".profile-QAPress-content").removeClass("active"),e(".QAPress-tab-item").eq(s).addClass("active"),e(".profile-QAPress-content").eq(s).addClass("active")}),e(".wpcom-profile").on("click",".j-user-questions,.j-user-answers",function(){if(!s){s=1;var a=e(this);if(a.hasClass("disabled"))s=0;else{var t=null,n=a.data("page");n=n?n+1:2;var i=e(".profile-QAPress-tab").data("user");a.hasClass("j-user-questions")?t={action:"QAPress_user_questions",user:i||0,page:n}:a.hasClass("j-user-answers")&&(t={action:"QAPress_user_answers",user:i||0,page:n}),a.parent().addClass("loading"),e.ajax({type:"POST",url:_wpcom_js.ajaxurl,data:t,dataType:"html",success:function(t){if("0"==t)a.addClass("disabled").text("已经到底了");else{var i=e(t);a.parent().before(i),i.find(".j-lazy").lazyload({threshold:-50,effect:"fadeIn"}),a.data("page",n),e(window).trigger("scroll")}a.parent().removeClass("loading"),s=0},error:function(){a.parent().removeClass("loading"),s=0}})}}})});